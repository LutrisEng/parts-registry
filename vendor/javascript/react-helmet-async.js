import t,{Component as n}from"react";import i from"prop-types";import o from"react-fast-compare";import l from"invariant";import p from"shallowequal";function a(){return a=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t},a.apply(this,arguments)}function s(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,c(t,n)}function c(t,n){return c=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t},c(t,n)}function u(t,n){if(null==t)return{};var i,o,l={},p=Object.keys(t);for(o=0;o<p.length;o++)n.indexOf(i=p[o])>=0||(l[i]=t[i]);return l}var f={BASE:"base",BODY:"body",HEAD:"head",HTML:"html",LINK:"link",META:"meta",NOSCRIPT:"noscript",SCRIPT:"script",STYLE:"style",TITLE:"title",FRAGMENT:"Symbol(react.fragment)"},d={rel:["amphtml","canonical","alternate"]},h={type:["application/ld+json"]},m={charset:"",name:["robots","description"],property:["og:type","og:title","og:url","og:image","og:image:alt","og:description","twitter:url","twitter:title","twitter:description","twitter:image","twitter:image:alt","twitter:card","twitter:site"]},y=Object.keys(f).map((function(t){return f[t]})),P={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},H=Object.keys(P).reduce((function(t,n){return t[P[n]]=n,t}),{}),T=function(t,n){for(var i=t.length-1;i>=0;i-=1){var o=t[i];if(Object.prototype.hasOwnProperty.call(o,n))return o[n]}return null},g=function(t){var n=T(t,f.TITLE),i=T(t,"titleTemplate");if(Array.isArray(n)&&(n=n.join("")),i&&n)return i.replace(/%s/g,(function(){return n}));var o=T(t,"defaultTitle");return n||o||void 0},b=function(t){return T(t,"onChangeClientState")||function(){}},v=function(t,n){return n.filter((function(n){return void 0!==n[t]})).map((function(n){return n[t]})).reduce((function(t,n){return a({},t,n)}),{})},A=function(t,n){return n.filter((function(t){return void 0!==t[f.BASE]})).map((function(t){return t[f.BASE]})).reverse().reduce((function(n,i){if(!n.length)for(var o=Object.keys(i),l=0;l<o.length;l+=1){var p=o[l].toLowerCase();if(-1!==t.indexOf(p)&&i[p])return n.concat(i)}return n}),[])},C=function(t,n,i){var o={};return i.filter((function(n){return!!Array.isArray(n[t])||(void 0!==n[t]&&console&&"function"==typeof console.warn&&console.warn("Helmet: "+t+' should be of type "Array". Instead found type "'+typeof n[t]+'"'),!1)})).map((function(n){return n[t]})).reverse().reduce((function(t,i){var l={};i.filter((function(t){for(var i,p=Object.keys(t),f=0;f<p.length;f+=1){var d=p[f],h=d.toLowerCase();-1===n.indexOf(h)||"rel"===i&&"canonical"===t[i].toLowerCase()||"rel"===h&&"stylesheet"===t[h].toLowerCase()||(i=h),-1===n.indexOf(d)||"innerHTML"!==d&&"cssText"!==d&&"itemprop"!==d||(i=d)}if(!i||!t[i])return!1;var m=t[i].toLowerCase();return o[i]||(o[i]={}),l[i]||(l[i]={}),!o[i][m]&&(l[i][m]=!0,!0)})).reverse().forEach((function(n){return t.push(n)}));for(var p=Object.keys(l),f=0;f<p.length;f+=1){var d=p[f],h=a({},o[d],l[d]);o[d]=h}return t}),[]).reverse()},O=function(t,n){if(Array.isArray(t)&&t.length)for(var i=0;i<t.length;i+=1)if(t[i][n])return!0;return!1},S=function(t){return Array.isArray(t)?t.join(""):t},E=function(t,n){return Array.isArray(t)?t.reduce((function(t,i){return function(t,n){for(var i=Object.keys(t),o=0;o<i.length;o+=1)if(n[i[o]]&&n[i[o]].includes(t[i[o]]))return!0;return!1}(i,n)?t.priority.push(i):t.default.push(i),t}),{priority:[],default:[]}):{default:t}},I=function(t,n){var i;return a({},t,((i={})[n]=void 0,i))},D=[f.NOSCRIPT,f.SCRIPT,f.STYLE],w=function(t,n){return void 0===n&&(n=!0),!1===n?String(t):String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},x=function(t){return Object.keys(t).reduce((function(n,i){var o=void 0!==t[i]?i+'="'+t[i]+'"':""+i;return n?n+" "+o:o}),"")},L=function(t,n){return void 0===n&&(n={}),Object.keys(t).reduce((function(n,i){return n[P[i]||i]=t[i],n}),n)},j=function(n,i){return i.map((function(i,o){var l,p=((l={key:o})["data-rh"]=!0,l);return Object.keys(i).forEach((function(t){var n=P[t]||t;"innerHTML"===n||"cssText"===n?p.dangerouslySetInnerHTML={__html:i.innerHTML||i.cssText}:p[n]=i[t]})),t.createElement(n,p)}))},M=function(n,i,o){switch(n){case f.TITLE:return{toComponent:function(){return o=i.titleAttributes,(l={key:n=i.title})["data-rh"]=!0,p=L(o,l),[t.createElement(f.TITLE,p,n)];var n,o,l,p},toString:function(){return function(t,n,i,o){var l=x(i),p=S(n);return l?"<"+t+' data-rh="true" '+l+">"+w(p,o)+"</"+t+">":"<"+t+' data-rh="true">'+w(p,o)+"</"+t+">"}(n,i.title,i.titleAttributes,o)}};case"bodyAttributes":case"htmlAttributes":return{toComponent:function(){return L(i)},toString:function(){return x(i)}};default:return{toComponent:function(){return j(n,i)},toString:function(){return function(t,n,i){return n.reduce((function(n,o){var l=Object.keys(o).filter((function(t){return!("innerHTML"===t||"cssText"===t)})).reduce((function(t,n){var l=void 0===o[n]?n:n+'="'+w(o[n],i)+'"';return t?t+" "+l:l}),""),p=o.innerHTML||o.cssText||"",f=-1===D.indexOf(t);return n+"<"+t+' data-rh="true" '+l+(f?"/>":">"+p+"</"+t+">")}),"")}(n,i,o)}}}},k=function(t){var n=t.baseTag,i=t.bodyAttributes,o=t.encode,l=t.htmlAttributes,p=t.noscriptTags,y=t.styleTags,P=t.title,H=void 0===P?"":P,D=t.titleAttributes,R=t.linkTags,U=t.metaTags,q=t.scriptTags,_={toComponent:function(){},toString:function(){return""}};if(t.prioritizeSeoTags){var z=function(t){var n=t.linkTags,i=t.scriptTags,o=t.encode,l=E(t.metaTags,m),p=E(n,d),y=E(i,h);return{priorityMethods:{toComponent:function(){return[].concat(j(f.META,l.priority),j(f.LINK,p.priority),j(f.SCRIPT,y.priority))},toString:function(){return M(f.META,l.priority,o)+" "+M(f.LINK,p.priority,o)+" "+M(f.SCRIPT,y.priority,o)}},metaTags:l.default,linkTags:p.default,scriptTags:y.default}}(t);_=z.priorityMethods,R=z.linkTags,U=z.metaTags,q=z.scriptTags}return{priority:_,base:M(f.BASE,n,o),bodyAttributes:M("bodyAttributes",i,o),htmlAttributes:M("htmlAttributes",l,o),link:M(f.LINK,R,o),meta:M(f.META,U,o),noscript:M(f.NOSCRIPT,p,o),script:M(f.SCRIPT,q,o),style:M(f.STYLE,y,o),title:M(f.TITLE,{title:H,titleAttributes:D},o)}},R=[],N=function(t,n){var i=this;void 0===n&&(n="undefined"!=typeof document),this.instances=[],this.value={setHelmet:function(t){i.context.helmet=t},helmetInstances:{get:function(){return i.canUseDOM?R:i.instances},add:function(t){(i.canUseDOM?R:i.instances).push(t)},remove:function(t){var n=(i.canUseDOM?R:i.instances).indexOf(t);(i.canUseDOM?R:i.instances).splice(n,1)}}},this.context=t,this.canUseDOM=n,n||(t.helmet=k({baseTag:[],bodyAttributes:{},encodeSpecialCharacters:!0,htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}}))},U=t.createContext({}),q=i.shape({setHelmet:i.func,helmetInstances:i.shape({get:i.func,add:i.func,remove:i.func})}),_="undefined"!=typeof document,z=function(n){function r(t){var i;return(i=n.call(this,t)||this).helmetData=new N(i.props.context,r.canUseDOM),i}return s(r,n),r.prototype.render=function(){return t.createElement(U.Provider,{value:this.helmetData.value},this.props.children)},r}(n);z.canUseDOM=_,z.propTypes={context:i.shape({helmet:i.shape()}),children:i.node.isRequired},z.defaultProps={context:{}},z.displayName="HelmetProvider";var Y=function(t,n){var i,o=document.head||document.querySelector(f.HEAD),l=o.querySelectorAll(t+"[data-rh]"),p=[].slice.call(l),d=[];return n&&n.length&&n.forEach((function(n){var o=document.createElement(t);for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&("innerHTML"===l?o.innerHTML=n.innerHTML:"cssText"===l?o.styleSheet?o.styleSheet.cssText=n.cssText:o.appendChild(document.createTextNode(n.cssText)):o.setAttribute(l,void 0===n[l]?"":n[l]));o.setAttribute("data-rh","true"),p.some((function(t,n){return i=n,o.isEqualNode(t)}))?p.splice(i,1):d.push(o)})),p.forEach((function(t){return t.parentNode.removeChild(t)})),d.forEach((function(t){return o.appendChild(t)})),{oldTags:p,newTags:d}},B=function(t,n){var i=document.getElementsByTagName(t)[0];if(i){for(var o=i.getAttribute("data-rh"),l=o?o.split(","):[],p=[].concat(l),f=Object.keys(n),d=0;d<f.length;d+=1){var h=f[d],m=n[h]||"";i.getAttribute(h)!==m&&i.setAttribute(h,m),-1===l.indexOf(h)&&l.push(h);var y=p.indexOf(h);-1!==y&&p.splice(y,1)}for(var P=p.length-1;P>=0;P-=1)i.removeAttribute(p[P]);l.length===p.length?i.removeAttribute("data-rh"):i.getAttribute("data-rh")!==f.join(",")&&i.setAttribute("data-rh",f.join(","))}},K=function(t,n){var i=t.baseTag,o=t.htmlAttributes,l=t.linkTags,p=t.metaTags,d=t.noscriptTags,h=t.onChangeClientState,m=t.scriptTags,y=t.styleTags,P=t.title,H=t.titleAttributes;B(f.BODY,t.bodyAttributes),B(f.HTML,o),function(t,n){void 0!==t&&document.title!==t&&(document.title=S(t)),B(f.TITLE,n)}(P,H);var D={baseTag:Y(f.BASE,i),linkTags:Y(f.LINK,l),metaTags:Y(f.META,p),noscriptTags:Y(f.NOSCRIPT,d),scriptTags:Y(f.SCRIPT,m),styleTags:Y(f.STYLE,y)},R={},U={};Object.keys(D).forEach((function(t){var n=D[t],i=n.newTags,o=n.oldTags;i.length&&(R[t]=i),o.length&&(U[t]=D[t].oldTags)})),n&&n(),h(t,R,U)},F=null,G=function(t){function e(){for(var n,i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return(n=t.call.apply(t,[this].concat(o))||this).rendered=!1,n}s(e,t);var n=e.prototype;return n.shouldComponentUpdate=function(t){return!p(t,this.props)},n.componentDidUpdate=function(){this.emitChange()},n.componentWillUnmount=function(){this.props.context.helmetInstances.remove(this),this.emitChange()},n.emitChange=function(){var t,n,i=this.props.context,o=i.setHelmet,l=null,p=(t=i.helmetInstances.get().map((function(t){var n=a({},t.props);return delete n.context,n})),{baseTag:A(["href"],t),bodyAttributes:v("bodyAttributes",t),defer:T(t,"defer"),encode:T(t,"encodeSpecialCharacters"),htmlAttributes:v("htmlAttributes",t),linkTags:C(f.LINK,["rel","href"],t),metaTags:C(f.META,["name","charset","http-equiv","property","itemprop"],t),noscriptTags:C(f.NOSCRIPT,["innerHTML"],t),onChangeClientState:b(t),scriptTags:C(f.SCRIPT,["src","innerHTML"],t),styleTags:C(f.STYLE,["cssText"],t),title:g(t),titleAttributes:v("titleAttributes",t),prioritizeSeoTags:O(t,"prioritizeSeoTags")});z.canUseDOM?(n=p,F&&cancelAnimationFrame(F),n.defer?F=requestAnimationFrame((function(){K(n,(function(){F=null}))})):(K(n),F=null)):k&&(l=k(p)),o(l)},n.init=function(){this.rendered||(this.rendered=!0,this.props.context.helmetInstances.add(this),this.emitChange())},n.render=function(){return this.init(),null},e}(n);G.propTypes={context:q.isRequired},G.displayName="HelmetDispatcher";var W=["children"],J=["children"],Q=function(n){function r(){return n.apply(this,arguments)||this}s(r,n);var i=r.prototype;return i.shouldComponentUpdate=function(t){return!o(I(this.props,"helmetData"),I(t,"helmetData"))},i.mapNestedChildrenToProps=function(t,n){if(!n)return null;switch(t.type){case f.SCRIPT:case f.NOSCRIPT:return{innerHTML:n};case f.STYLE:return{cssText:n};default:throw new Error("<"+t.type+" /> elements are self-closing and can not contain children. Refer to our API for more information.")}},i.flattenArrayTypeChildren=function(t){var n,i=t.child,o=t.arrayTypeChildren;return a({},o,((n={})[i.type]=[].concat(o[i.type]||[],[a({},t.newChildProps,this.mapNestedChildrenToProps(i,t.nestedChildren))]),n))},i.mapObjectTypeChildren=function(t){var n,i,o=t.child,l=t.newProps,p=t.newChildProps,d=t.nestedChildren;switch(o.type){case f.TITLE:return a({},l,((n={})[o.type]=d,n.titleAttributes=a({},p),n));case f.BODY:return a({},l,{bodyAttributes:a({},p)});case f.HTML:return a({},l,{htmlAttributes:a({},p)});default:return a({},l,((i={})[o.type]=a({},p),i))}},i.mapArrayTypeChildrenToProps=function(t,n){var i=a({},n);return Object.keys(t).forEach((function(n){var o;i=a({},i,((o={})[n]=t[n],o))})),i},i.warnOnInvalidChildren=function(t,n){return l(y.some((function(n){return t.type===n})),"function"==typeof t.type?"You may be attempting to nest <Helmet> components within each other, which is not allowed. Refer to our API for more information.":"Only elements types "+y.join(", ")+" are allowed. Helmet does not support rendering <"+t.type+"> elements. Refer to our API for more information."),l(!n||"string"==typeof n||Array.isArray(n)&&!n.some((function(t){return"string"!=typeof t})),"Helmet expects a string as a child of <"+t.type+">. Did you forget to wrap your children in braces? ( <"+t.type+">{``}</"+t.type+"> ) Refer to our API for more information."),!0},i.mapChildrenToProps=function(n,i){var o=this,l={};return t.Children.forEach(n,(function(t){if(t&&t.props){var n=t.props,p=n.children,d=u(n,W),h=Object.keys(d).reduce((function(t,n){return t[H[n]||n]=d[n],t}),{}),m=t.type;switch("symbol"==typeof m?m=m.toString():o.warnOnInvalidChildren(t,p),m){case f.FRAGMENT:i=o.mapChildrenToProps(p,i);break;case f.LINK:case f.META:case f.NOSCRIPT:case f.SCRIPT:case f.STYLE:l=o.flattenArrayTypeChildren({child:t,arrayTypeChildren:l,newChildProps:h,nestedChildren:p});break;default:i=o.mapObjectTypeChildren({child:t,newProps:i,newChildProps:h,nestedChildren:p})}}})),this.mapArrayTypeChildrenToProps(l,i)},i.render=function(){var n=this.props,i=n.children,o=u(n,J),l=a({},o),p=o.helmetData;return i&&(l=this.mapChildrenToProps(i,l)),!p||p instanceof N||(p=new N(p.context,p.instances)),p?t.createElement(G,a({},l,{context:p.value,helmetData:void 0})):t.createElement(U.Consumer,null,(function(n){return t.createElement(G,a({},l,{context:n}))}))},r}(n);Q.propTypes={base:i.object,bodyAttributes:i.object,children:i.oneOfType([i.arrayOf(i.node),i.node]),defaultTitle:i.string,defer:i.bool,encodeSpecialCharacters:i.bool,htmlAttributes:i.object,link:i.arrayOf(i.object),meta:i.arrayOf(i.object),noscript:i.arrayOf(i.object),onChangeClientState:i.func,script:i.arrayOf(i.object),style:i.arrayOf(i.object),title:i.string,titleAttributes:i.object,titleTemplate:i.string,prioritizeSeoTags:i.bool,helmetData:i.object},Q.defaultProps={defer:!0,encodeSpecialCharacters:!0,prioritizeSeoTags:!1},Q.displayName="Helmet";export{Q as Helmet,N as HelmetData,z as HelmetProvider};

